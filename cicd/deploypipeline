node {
  properties([
    parameters([
      string(name: 'image_source', defaultValue: 'ronyvarghese3/webserver-test-amd64:21', description: 'source image URL including version',),
      string(name: 'target_namespace', defaultValue: 'ronyvarghese3-dev', description: 'namespace to which app is to be deployed',)
    ])
  ])
  def image_source = "${params.image_source}"
  def target_namespace = "${params.target_namespace}"

  stage('verification'){
    if ( $target_namespace != 'ronyvarghese3-dev' ){
      error("This pipeline is meant to be used for deploying into ronyvarghese3-dev namespace only")
    }
  }

  stage('Deploying into Openshift') {
              sh "oc process -f ./configuration/deployment.yaml -p image_source=${image_source} -n ronyvarghese3-dev | oc apply -f - -n ronyvarghese3-dev"
  }

  if (currentBuild.currentResult == 'SUCCESS') { 
      stage('Deploy') { 
        sh './deployscript'  
      } 
  } 
}
